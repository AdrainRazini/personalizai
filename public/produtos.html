<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Produtos</title>
   <link rel="shortcut icon" href="img/favicon/personalizai.ico" type="image/x-icon">
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; }
    .actions button { margin-right: 0.5rem; }
  </style>
</head>
<body>
<h1>Produtos Cadastrados</h1>
<a href="adicionar.html"><button>Adicionar Novo Produto</button></a>

<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Código</th>
      <th>Categoria</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody id="produtos-tbody"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBRrvG3NIL_SdUIRTslSOzKG-B9lmH8LaA",
  authDomain: "personalizai-login-data.firebaseapp.com",
  projectId: "personalizai-login-data",
  storageBucket: "personalizai-login-data.firebasestorage.app",
  messagingSenderId: "1044986495943",
  appId: "1:1044986495943:web:21db46ad8b5a8694700fe2",
  measurementId: "G-FKL4MNFS4E"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tbody = document.getElementById('produtos-tbody');

  async function carregarProdutos() {
    tbody.innerHTML = "";
    const querySnapshot = await getDocs(collection(db, "produtos"));
    querySnapshot.forEach((docSnap) => {
      const produto = docSnap.data();
      const id = docSnap.id;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${produto.nome}</td>
        <td>${produto.codigo}</td>
        <td>${produto.categoria}</td>
        <td class="actions">
           <a href="ver.html?id=${id}"><button>Ver</button></a>
          <a href="editar.html?id=${id}"><button>Editar</button></a>
          <button style="color:red;" onclick="deletarProduto('${id}')">Deletar</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.deletarProduto = async function (id) {
    if (confirm("Deseja excluir este produto?")) {
      await deleteDoc(doc(db, "produtos", id));
      carregarProdutos();
    }
  };

  carregarProdutos();
</script>
</body>
</html>
